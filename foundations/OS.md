## 硬件结构

### 软中断

**中断**是计算机系统用来响应硬件设备请求的一种机制，操作系统收到中断请求，会打断正在执行的进程，然后调用内核中的中断处理程序来响应请求

中断是一种异步的事件处理机制，可以提供系统的并发处理能力

Linux系统为了解决中断处理程序执行过长和中断丢失的问题，将中断过程分为两个阶段：

- 上半部是硬中断，用来快速处理中断
- 下半部是软中断，用来延迟处理上半部未完成的工作

Linux的软中断包括网络收发、定时、调度、RCU锁等类型，可以通过/proc/softirqs来观察软中断的累积中断次数

每个CPU核心都有各自的软中断内核线程

### 计算机存储小数

计算机对于整数的存储是使用二进制，最高位是符号位，剩余位置用于表示二进制数，对于负数符号位是1，剩余位置是补码表示

对于小数，转换为二进制的方法是乘2取整法，例如0.625转换为二进制就是.101

而对于0.1，转换为二进制就是0.00011001100110011...无限循环，所以0.1是无法用完整的二进制表示的，只能以近似数的方式来保存

计算机中能够精确表示的小数是可以被2除尽的数字

因此计算机中0.1+0.2并不完整等于0.3

## 操作系统结构

### 内核

内核是连接应用程序与硬件设备的桥梁，应用程序只需要与内核交互，不用关心硬件的细节

内核的能力：

- 管理进程、线程，决定哪个进程、线程使用CPU，也就是进程调度的能力
- 管理内存，决定内存的分配和回收，也就是内存管理的能力
- 管理硬件设备，为进程与硬件设备之间提供通信能力，也就是硬件通信能力
- 提供系统调用，如果应用程序要更高权限来运行服务，就需要系统调用，它是用户程序与操作系统之间的接口

大多数操作系统会把内存分为：

- 内核空间，只有内核程序可以访问
- 用户空间，专门给应用程序使用

用户空间的代码只能访问一个局部的内存空间，也就是用户态执行，而内核空间的代码可以访问所有内存空间，也就是内核态执行

### Linux设计

Linux内核设计理念：

- MultiTask，多任务，可以有多个任务并发或并行运行
- SMP，对称多处理，每个CPU的地位都是相等的，每个程序都可以被分配到任意一个CPU上执行
- ELF，可执行文件链接格式，可执行文件的存储格式
- Monolithic Kernel，宏内核，系统内核的所有模块如进程调度、内存管理、文件系统、设备驱动等都在内核态运行，相对应的是微内核，内核只保留基本能力如进程调度、虚拟机内存、中断等，一些应用被放到用户空间如驱动程序、文件系统

## 内存管理