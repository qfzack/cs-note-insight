- 设计模式
  - 微服务架构设计、开发、维护，包括创建松耦合的服务，支持独立开发、部署和扩展
  - 服务拆分：领域驱动设计、业务边界划分
  - API设计：RESTful API、gRPC、GraphQL
  - 服务通信：同步/异步通信、消息队列
  - 服务治理：服务注册发现、配置管理、熔断降级

---

微服务系统的架构设计和常用组件
> https://cloud.tencent.com/developer/article/2370879

- 反向代理
  - 反向代理是系统流量的入口，常见的有Nginx，HAProxy，Envoy，Traefik
  - 主要功能有：
    - 负载均衡：可以将请求分发到多个后端微服务实例，实现负载均衡、提供系统的可伸缩性和性能
    - SSL终结：处理传入的HTTPS流量，负责SSL/TLS终结，解密和加密数据，减轻后端服务的负担
    - 安全性增强：反向代理可以作为安全屏障，执行身份验证、授权和访问控制，保护服务免受恶意攻击
    - 请求路由：根据请求的内容、路径或其他规则将流量路由到不同的服务实例
    - 静态资源服务：可以用于提供静态资源文件服务，如图片、CSS和js文件，减轻后端负载
- API网关
  - 反向代理经过API网关控制，将请求分发到微服务集群中的各个微服务，API网关分发流量是基于路由的，路由根据服务列表进行配置，通常会有一个服务注册与发现系统来帮助维护集群中的微服务状态信息
  - API网关是管理外部访问的API门户，通常会与反向代理合并为一个组件，主要功能：
    - 统一入口：提供统一的API入口，使客户端只需要与API网关通信，而无需与各个微服务通信，简化了服务端与客户端的通信
    - 认证授权：如JWT验证、OAuth支持
    - 请求路由：将请求路由到具体微服务
    - 限流、熔断、重试：提高系统稳定性
    - 聚合响应：多个服务结果组合为一个返回结果（BFF模式）
    - 协议与请求的转换
  - 常见的实现有Kong、Istio、Spring Cloud Gateway
- 服务注册与发现
  - 管理和维护集群中微服务的状态信息，主要作用是：
    - 服务注册：微服务实例启动时将自身信息（IP、端口、状态）注册到注册中心
    - 服务发现：客户端通过查询注册中心，获取可用的服务实例列表，从而动态发现并与需要的服务进行通信
    - 动态负载均衡：通过服务发现，可以实现动态负载均衡，将请求分发到多个可用的服务实例
    - 故障处理：服务注册发现可以检测到微服务实例的健康状态，确保故障或下线的节点不会被访问
    - 适应性扩展：支持微服务实例的动态扩展和缩减
  - 常见的实现有consul、eureka、etcd、nacos、zookeeper等
- 配置中心
  - 集中管理和动态更新微服务运行时的服务配置获取，主要功能：
    - 集中管理配置：提供集中式管理微服务系统的配置信息，避免配置散布在各个微服务中，使得配置更加可维护和一致性
    - 动态更新配置：无需重启服务即可应用新的配置，提高系统的灵活性和可维护性
    - 版本控制：支持配置的版本控制，能够追踪配置的变更历史，方便进行回滚和版本管理
    - 安全性管理：提供安全的配置管理机制，确保敏感信息如数据库密码等得到保护，并允许对不同环境配置进行适当控制
    - 实时监控：提供实时监控和统计，可以了解各个微服务当前使用的配置信息，便于系统运维和性能优化
  - 常见的实现有spring cloud config、consul、nacos、etcd、apollo等
- 链路追踪
  - 用于检测和分析分布式系统中请求在不同服务之间的流转路径的技术，其作用包括：
    - 故障排查：快速定位分布式系统中的故障和性能问题，减少故障排查的时间
    - 性能优化：提供对请求执行路径的可视化，有助于优化系统性能和识别潜在的性能瓶颈
    - 事务追踪：能够追溯分布式事务的整个执行过程，确保事务的一致性和可靠性
    - 监控分析：通过链路追踪数据进行监控和分析，为系统提供实时的性能指标和可视化的分析报告
    - 用户体验：改善中断用户体验、通过了解请求路径，确保系统对用户请求的快速响应
  - 常见的实现有Zipkin、Jaeger等
- 为了更好地进行服务治理，还需要日志系统、监控系统、任务调度等
- 数据的存储与检索还需要关系型数据库、分布式缓存、对象存储、索引数据库、消息队列等
  - 关系型数据库：持久化存储，如mysql、oracaldb等
  - 分布式缓存：提高数据访问性能和降低数据库负载，如redis、memcached等
  - 文件、对象存储：HDFS、Amazon S3、Google Cloud Storage等
  - 索引仓库：提供高效的数据检索和查询功能，如elasticsearch、apache solr等
  - 消息队列：实现异步通信和解耦，如kafka、rabbitMQ等

项目中如何保证微服务敏捷开发
- 采用敏捷开发方法可以保证微服务的快速开发和迭代，敏捷开发的思想是通过设立单个任务目标，进行业务更新的快速迭代，并且可以快速上线，敏捷开发主要依靠：
  1. 代码分支管理：每个任务在自己的分支上进行开发，不同的任务开发互不干扰
  2. 站会会议：每天短暂的站会中团队成员分享自己的任务进度和遇到的问题，这样可以快速跟进每个任务的进度，及时解决问题，并保持团队的协同性
  3. 进度面板：使用项目管理工具来跟踪任务的进度，通过在进度面板上创建任务、设置优先级和状态，我们可以清晰地了解每个任务的状态和进度
  4. 开发环境支持：为了敏捷开发，建立多个环境，包括测试环境、预发布环境和生产环境，在测试环境中进行功能测试和集成测试，确保代码的质量和稳定性，预发布环境用于模拟生产环境，进行最后的验证和性能测试，生产环境是最终部署和运行的环境

微服务存在的问题（为什么需要服务治理）
- 因为微服务架构引入了新的问题和复杂度，服务治理是为了解决这些非功能性问题，确保微服务系统在真实生产环境中可用、稳定、可观测：
  - 服务注册与发现：单体服务拆分为微服务之后，微服务之间存在调用依赖就需要得到目标服务的服务地址，也就是微服务治理的服务发现
  - 可观测性：微服务相比于单体服务有了更多的部署载体，需要对众多微服务之间的调用关系、状态有清晰的掌控，可观测性就包括了调用拓扑关系、监控、日志、调用追踪等
  - 流量管理：微服务的版本更新迭代过程中，需要对微服务之间的调用进行控制，以完成微服务版本更迭的平滑，这需要根据流量的特征、百分比向不同版本服务分发，这也孵化出灰度发布、蓝绿发布、A/B测试等方式
  - 安全：不同微服务有自身的职责，对于业务敏感的微服务，需要对其他服务的访问进行认证与鉴权，也就是安全问题
  - 控制：对服务治理能力充分建设后，需要有足够的控制能力，能实时进行服务治理策略向微服务分发

服务治理包括哪些内容
- 服务注册与发现
- 负载均衡
- 熔断/降级：某个服务异常时快速失败，避免传染系统
- 限流：控制访问频率，保护系统
- 超时重试：防止服务阻塞，提升鲁棒性
- 链路追踪：观察一次请求在多个服务中如何流转
- 监控告警：收集服务指标、异常告警
- 安全：服务间通信的认证/鉴权
- 配置管理：配置项集中管理、动态更新
- 服务网关：请求统一入口、鉴权、限流、协议转换

如何实现微服务治理
- 微服务治理有两种方式：
  1. SDK模式：每个微服务引入治理SDK，自带注册、重试、熔断、限流功能
  2. 服务网格模式：将治理逻辑从服务中抽离，由独立进程代理（如Istio的Envoy）处理治理功能

如何实现微服务的链路追踪、持续集成、AB发布
- 链路追踪
  - 链路追踪是一种监控和分析系统中各个组件之间的请求路径和性能的技术，可以使用ELK等工具来实现链路追踪：
    1. 在每个微服务中，添加代码来生成一个唯一的业务ID，并将该ID传递给相关的服务
    2. 将每个微服务中日志发送到集中式日志系统，如Elasticsearch
    3. 使用Kibana等工具来查询和分析链路日志，可以根据业务ID关联和追踪整个请求路径，以及查看各个环节的性能指标
- 持续集成
  - 持续集成是一种软件开发实践，通过频繁将代码集成到主干分支，并进行自动化的构建、测试和部署，以确保代码质量和快速交付：
    - 使用版本控制系统管理代码，并建立主干分支和开发分支
    - 使用构建工具（如Maven、Gradle）来自动化构建过程，包括编译、打包等
    - 使用自动化测试工具（如JUint）编写测试用例，并在构建过程中执行测试
    - 使用持续集成工具（如Jenkins）设置流水线，定义构建、测试和部署的步骤，并触发自动化流程
- AB发布是一种逐步推出新功能或者更新的发布策略，可以在生产环境中逐渐引入新功能，以降低风险和影响：
  - 在预发布环境中部署新功能或更新，只对少部分用户或流量进行测试
  - 监控和收集预发布环境的性能和稳定性数据，确保新功能正常运行
  - 根据收集的数据和测试结果，决定是否继续推出新功能
  - 如果新功能通过了测试并且运行稳定，可以通过全量发布的方式将其应用于整个生产环境，或者根据需要进行灰度发布或者金丝雀发布，逐渐扩大用户范围

K8s提供了哪些服务治理的功能，需要补充哪些
- 服务注册与发现
  - 内建了service+DNS，实现pod的自动注册，DNS自动发现
- 负载均衡
  - 内建clusterIP+kubeproxy，可以将请求自动分发到多个pod
- 除此之外需要引入的组件：服务网格（Istio、Linkerd）、API网关（Kong、Istio gateway）、熔断/限流/降级（Istio）、链路追踪（Opentelemetry）、配置中心（Nacos，Apollo）、监控/告警（Prometheus）
